{"version":3,"file":"static/webpack/static/development/pages/_app.js.4e2dfafbdf0dbf08f7f2.hot-update.js","sources":["webpack:///./src/utils/redux/configureStore.ts"],"sourcesContent":["import {\n  createStore,\n  combineReducers,\n  ReducersMapObject,\n  Reducer,\n  StoreEnhancer,\n  Store,\n  Action,\n  Middleware,\n} from 'redux';\nimport createSagaMiddleware, { Saga } from 'redux-saga';\nimport objectAssign from '../common/objectAssign';\nimport { MakeStore } from './withRedux';\nimport { SagaTaskProp } from './withReduxSaga';\n\ninterface StoreReducerEnhanced extends Partial<SagaTaskProp> {\n  commonReducers: ReducersMapObject;\n  asyncReducers: ReducersMapObject;\n  addReducer(key: string, asyncReducer: Reducer): void;\n  removeReducer(key: string): void;\n  injectReducers(reducers: ReducersMapObject): void;\n  substitueReducers(reducers: ReducersMapObject): void;\n}\n\nexport interface ReducerEnhancedStore extends Store, StoreReducerEnhanced {}\n\nconst configureStore = ({\n  commonReducers,\n  enhancer,\n  middlewareArray = [],\n  rootSaga,\n}: {\n  commonReducers: ReducersMapObject;\n  enhancer(...args: Middleware[]): StoreEnhancer;\n  middlewareArray?: Middleware[];\n  rootSaga?: Saga;\n}): MakeStore<ReducerEnhancedStore> => (initialState: any = {}) => {\n  let keysToRemove: string[] = [];\n\n  const createReducer = (asyncReducers?: ReducersMapObject) => (state: any, action: Action) => {\n    let updatedState = state;\n    if (keysToRemove.length > 0) {\n      updatedState = objectAssign(([k]) => !(k in keysToRemove))({}, state);\n      keysToRemove = [];\n    }\n    return combineReducers({\n      ...commonReducers,\n      ...asyncReducers,\n    })(updatedState, action);\n  };\n\n  const sagaMiddleware = createSagaMiddleware();\n\n  middlewareArray.unshift(sagaMiddleware);\n  const store: ReducerEnhancedStore = Object.assign(\n    createStore(createReducer(), initialState, enhancer(...middlewareArray)),\n    {\n      commonReducers,\n      asyncReducers: {},\n\n      addReducer: (key, asyncReducer) => {\n        if (!key || store.asyncReducers[key]) {\n          return;\n        }\n        store.asyncReducers[key] = asyncReducer;\n        store.replaceReducer(createReducer(store.asyncReducers));\n      },\n\n      removeReducer: key => {\n        if (!key || !store.asyncReducers[key]) {\n          return;\n        }\n        delete store.asyncReducers[key];\n        keysToRemove.push(key);\n        store.replaceReducer(createReducer(store.asyncReducers));\n      },\n\n      injectReducers: reducers => {\n        objectAssign()(store.asyncReducers, reducers);\n        store.replaceReducer(createReducer(store.asyncReducers));\n      },\n\n      substitueReducers: reducers => {\n        console.log(keysToRemove);\n        keysToRemove.push(...Object.keys(store.asyncReducers).filter(k => { console.log(k, reducers, !(k in reducers)); return !(k in reducers)}));\n        console.log(keysToRemove);\n        store.asyncReducers = reducers;\n        store.replaceReducer(createReducer(store.asyncReducers));\n      },\n\n      sagaTask: rootSaga ? sagaMiddleware.run(rootSaga) : undefined,\n    } as StoreReducerEnhanced\n  );\n\n  return store;\n};\n\nexport default configureStore;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAUA;AACA;AACA;AAcA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AACA;AACA;AAAA;AAIA;AAVA;AACA;AAWA;AAEA;AACA;AAAA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAlCA;AACA;AAqCA;AACA;AArEA;AACA;AAsEA;;;;A","sourceRoot":""}